<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Herramienta de Limpieza IA</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script>
        tailwind.config = {
            darkMode: 'class'
        }
    </script>
    <script>
        // On page load or when changing themes, best to add inline in `head` to avoid FOUC
        if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark')
        } else {
            document.documentElement.classList.remove('dark')
        }
    </script>
    <link rel="stylesheet" href="styles.css">
</head>

<body
    class="min-h-screen p-4 sm:p-6 lg:p-8 flex flex-col items-center justify-center bg-slate-100 dark:bg-[#13141c] text-slate-800 dark:text-slate-200">

    <!-- Wrapper Principal Dark -->
    <div
        class="max-w-[1400px] w-full bg-white dark:bg-[#1b1c26] rounded-3xl border border-slate-300 dark:border-slate-700/50 shadow-2xl overflow-hidden flex flex-col lg:flex-row shadow-[#000000_0px_50px_100px_-20px]">

        <!-- Panel de Controles -->
        <div
            class="w-full lg:w-[420px] xl:w-[480px] p-6 sm:p-8 bg-white dark:bg-[#1b1c26] border-b lg:border-b-0 lg:border-r border-slate-300 dark:border-slate-700/50 flex flex-col gap-6 overflow-y-auto max-h-[90vh] custom-scroll">

            <div class="flex items-center justify-between mb-1">
                <h1 class="text-xl font-semibold text-slate-900 dark:text-white flex items-center gap-2">
                    Herramienta de Limpieza IA <span
                        class="text-sm font-normal text-slate-500 dark:text-slate-400">(Powered by
                        Gemini)</span>
                </h1>

                <!-- Theme Toggle Button -->
                <button id="themeToggle"
                    class="p-2 rounded-lg bg-slate-200 dark:bg-slate-800 text-slate-500 dark:text-slate-400 hover:bg-slate-300 dark:hover:bg-slate-700 transition-colors">
                    <!-- Sun icon (shows in dark mode) -->
                    <svg id="themeToggleLightIcon" class="hidden w-5 h-5" fill="none" stroke="currentColor"
                        viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z">
                        </path>
                    </svg>
                    <!-- Moon icon (shows in light mode) -->
                    <svg id="themeToggleDarkIcon" class="hidden w-5 h-5" fill="none" stroke="currentColor"
                        viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z">
                        </path>
                    </svg>
                </button>
            </div>

            <!-- TABS MODO -->
            <div class="flex bg-slate-800 rounded-lg p-1 w-full mt-2">
                <button id="tabIndividual"
                    class="flex-1 py-1.5 text-sm font-medium rounded-md bg-indigo-500 text-slate-900 dark:text-white shadow">Individual</button>
                <button id="tabBatch"
                    class="flex-1 py-1.5 text-sm font-medium rounded-md text-slate-500 dark:text-slate-400 hover:text-slate-900 dark:text-white transition">Por
                    Lote (Batch)</button>
            </div>

            <div id="panelIndividual" class="flex flex-col gap-6">

                <!-- 1. Selección de Imagen -->
                <div class="flex flex-col">
                    <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-3">1. Selección de
                        Imagen</label>

                    <!-- Carga de archivo -->
                    <div
                        class="relative bg-slate-100 dark:bg-[#13141c]/50 rounded-2xl border border-slate-300 dark:border-slate-700/50 p-6 flex flex-col items-center justify-center hover:border-indigo-500/50 transition-colors shadow-inner upload-box">
                        <input type="file" id="imageInput" accept="image/png, image/jpeg, image/webp"
                            class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10">

                        <div
                            class="bg-white dark:bg-[#1b1c26] p-3 rounded-2xl mb-4 border border-slate-300 dark:border-slate-700/50 glow-icon">
                            <svg class="w-6 h-6 text-indigo-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                                    d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path>
                            </svg>
                        </div>
                        <p class="text-slate-700 dark:text-slate-300 text-sm mb-4">Arrastra y suelta tu imagen aquí</p>
                        <button
                            class="bg-transparent border border-slate-600 text-slate-700 dark:text-slate-300 hover:text-slate-900 dark:text-white hover:border-slate-400 px-4 py-2 rounded-lg text-xs font-medium transition-colors mb-3">
                            Elegir archivo
                        </button>
                        <p class="text-[10px] text-slate-500">Tamaño máximo: 50MB, Formatos: JPG, PNG, WEBP</p>
                    </div>

                    <!-- Galería de prueba rápida -->
                    <div class="mt-4">
                        <label
                            class="block text-xs font-semibold text-slate-500 dark:text-slate-400 mb-2 uppercase tracking-wider">PRUEBAS
                            RÁPIDAS</label>
                        <div class="grid grid-cols-4 gap-2" id="testGallery">
                            <div class="relative group"><img src="img/1.1.png"
                                    class="test-img w-full h-12 rounded-lg border border-slate-300 dark:border-slate-700 hover:border-indigo-400 object-cover cursor-pointer bg-slate-50 dark:bg-[#2a2b36] grayscale-[30%] hover:grayscale-0 transition-all"
                                    title="1:1" onerror="this.style.display='none'"><span
                                    class="block text-center mt-1 text-[10px] text-slate-500 dark:text-slate-400 group-hover:text-slate-800 dark:text-slate-200">Ejemplo</span>
                            </div>
                            <div class="relative group"><img src="img/9.16.png"
                                    class="test-img w-full h-12 rounded-lg border border-slate-300 dark:border-slate-700 hover:border-indigo-400 object-cover cursor-pointer bg-slate-50 dark:bg-[#2a2b36] grayscale-[30%] hover:grayscale-0 transition-all"
                                    title="9:16" onerror="this.style.display='none'"><span
                                    class="block text-center mt-1 text-[10px] text-slate-500 dark:text-slate-400 group-hover:text-slate-800 dark:text-slate-200">Ejemplo</span>
                            </div>
                            <div class="relative group"><img src="img/16.9.png"
                                    class="test-img w-full h-12 rounded-lg border border-slate-300 dark:border-slate-700 hover:border-indigo-400 object-cover cursor-pointer bg-slate-50 dark:bg-[#2a2b36] grayscale-[30%] hover:grayscale-0 transition-all"
                                    title="16:9" onerror="this.style.display='none'"><span
                                    class="block text-center mt-1 text-[10px] text-slate-500 dark:text-slate-400 group-hover:text-slate-800 dark:text-slate-200">Ejemplo</span>
                            </div>
                            <div class="relative group"><img src="img/3.4.png"
                                    class="test-img w-full h-12 rounded-lg border border-slate-300 dark:border-slate-700 hover:border-indigo-400 object-cover cursor-pointer bg-slate-50 dark:bg-[#2a2b36] grayscale-[30%] hover:grayscale-0 transition-all"
                                    title="3:4" onerror="this.style.display='none'"><span
                                    class="block text-center mt-1 text-[10px] text-slate-500 dark:text-slate-400 group-hover:text-slate-800 dark:text-slate-200">Ejemplo</span>
                            </div>
                            <div class="relative group"><img src="img/4.3.png"
                                    class="test-img w-full h-12 rounded-lg border border-slate-300 dark:border-slate-700 hover:border-indigo-400 object-cover cursor-pointer bg-slate-50 dark:bg-[#2a2b36] grayscale-[30%] hover:grayscale-0 transition-all"
                                    title="4:3" onerror="this.style.display='none'"><span
                                    class="block text-center mt-1 text-[10px] text-slate-500 dark:text-slate-400 group-hover:text-slate-800 dark:text-slate-200">Ejemplo</span>
                            </div>
                            <div class="relative group"><img src="img/5.4.png"
                                    class="test-img w-full h-12 rounded-lg border border-slate-300 dark:border-slate-700 hover:border-indigo-400 object-cover cursor-pointer bg-slate-50 dark:bg-[#2a2b36] grayscale-[30%] hover:grayscale-0 transition-all"
                                    title="5:4" onerror="this.style.display='none'"><span
                                    class="block text-center mt-1 text-[10px] text-slate-500 dark:text-slate-400 group-hover:text-slate-800 dark:text-slate-200">Ejemplo</span>
                            </div>
                            <div class="relative group"><img src="img/4.5.png"
                                    class="test-img w-full h-12 rounded-lg border border-slate-300 dark:border-slate-700 hover:border-indigo-400 object-cover cursor-pointer bg-slate-50 dark:bg-[#2a2b36] grayscale-[30%] hover:grayscale-0 transition-all"
                                    title="4:5" onerror="this.style.display='none'"><span
                                    class="block text-center mt-1 text-[10px] text-slate-500 dark:text-slate-400 group-hover:text-slate-800 dark:text-slate-200">Ejemplo</span>
                            </div>
                            <div class="relative group"><img src="img/21.9.png"
                                    class="test-img w-full h-12 rounded-lg border border-slate-300 dark:border-slate-700 hover:border-indigo-400 object-cover cursor-pointer bg-slate-50 dark:bg-[#2a2b36] grayscale-[30%] hover:grayscale-0 transition-all"
                                    title="21:9" onerror="this.style.display='none'"><span
                                    class="block text-center mt-1 text-[10px] text-slate-500 dark:text-slate-400 group-hover:text-slate-800 dark:text-slate-200">Ejemplo</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 2. Configuración de Detección -->
                <div id="controlsArea" class="opacity-50 pointer-events-none transition-opacity duration-500">
                    <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-3">2. Configuración de
                        Detección</label>

                    <div class="mb-5">
                        <label class="block text-xs text-slate-500 dark:text-slate-400 mb-2">Modo de Detección</label>
                        <select id="shapeSelect"
                            class="bg-slate-100 dark:bg-[#13141c] border border-indigo-500/30 text-slate-800 dark:text-slate-200 text-sm font-medium rounded-lg focus:ring-indigo-500 focus:border-indigo-500 block w-full p-2.5 shadow-sm outline-none appearance-none">
                            <option value="circle" selected>Círculo / Óvalo (Recomendado)</option>
                            <option value="star">Estrella (Gemini) Pro - Detección Profunda</option>
                            <option value="rect">Cuadrado / Rectángulo</option>
                            <option value="manual">Dibujo Libre (Pincel manual)</option>
                        </select>
                    </div>

                    <div id="formatBadge" class="mb-4 hidden text-center"></div>

                    <!-- Controles Automáticos -->
                    <div id="autoControls" class="space-y-6">
                        <div>
                            <div
                                class="flex justify-between items-center text-xs text-slate-700 dark:text-slate-300 mb-2">
                                <span class="flex items-center gap-2"><svg
                                        class="w-3 h-3 text-slate-500 dark:text-slate-400" fill="currentColor"
                                        viewBox="0 0 20 20">
                                        <path d="M10 2a8 8 0 100 16 8 8 0 000-16zM8 10a2 2 0 114 0 2 2 0 01-4 0z" />
                                    </svg> Ancho de la máscara</span>
                                <div
                                    class="bg-slate-50 dark:bg-[#2a2b36] px-2 py-0.5 rounded text-slate-700 dark:text-slate-300 flex items-center gap-1">
                                    <input type="number" id="numWidth" value="60" min="10"
                                        class="w-10 bg-transparent text-right outline-none">
                                    <span>px</span>
                                </div>
                            </div>
                            <input type="range" id="markWidth" min="10" max="500" value="60"
                                class="glow-slider w-full h-1 bg-slate-700/50 rounded-lg appearance-none cursor-pointer">
                        </div>

                        <div>
                            <div
                                class="flex justify-between items-center text-xs text-slate-700 dark:text-slate-300 mb-2">
                                <span class="flex items-center gap-2"><svg
                                        class="w-3 h-3 text-slate-500 dark:text-slate-400" fill="currentColor"
                                        viewBox="0 0 20 20">
                                        <path fill-rule="evenodd"
                                            d="M10 18a8 8 0 100-16 8 8 0 000 16zM7 9a1 1 0 000 2h6a1 1 0 100-2H7z"
                                            clip-rule="evenodd" />
                                    </svg> Alto de la máscara</span>
                                <div
                                    class="bg-slate-50 dark:bg-[#2a2b36] px-2 py-0.5 rounded text-slate-700 dark:text-slate-300 flex items-center gap-1">
                                    <input type="number" id="numHeight" value="60" min="10"
                                        class="w-10 bg-transparent text-right outline-none">
                                    <span>px</span>
                                </div>
                            </div>
                            <input type="range" id="markHeight" min="10" max="500" value="60"
                                class="glow-slider w-full h-1 bg-slate-700/50 rounded-lg appearance-none cursor-pointer">
                        </div>

                        <div>
                            <div
                                class="flex justify-between items-center text-xs text-slate-700 dark:text-slate-300 mb-2">
                                <span>Mover Izq/Der</span>
                                <div
                                    class="bg-slate-50 dark:bg-[#2a2b36] px-2 py-0.5 rounded text-slate-700 dark:text-slate-300 flex items-center gap-1">
                                    <input type="number" id="numRight" value="60" min="0" maxlength="4"
                                        class="w-10 bg-transparent text-right outline-none">
                                    <span>px</span>
                                </div>
                            </div>
                            <input type="range" id="markRight" min="0" max="1000" value="60"
                                class="glow-slider w-full h-1 bg-slate-700/50 rounded-lg appearance-none cursor-pointer">
                        </div>

                        <div>
                            <div
                                class="flex justify-between items-center text-xs text-slate-700 dark:text-slate-300 mb-2">
                                <span>Mover Arriba/Abajo</span>
                                <div
                                    class="bg-slate-50 dark:bg-[#2a2b36] px-2 py-0.5 rounded text-slate-700 dark:text-slate-300 flex items-center gap-1">
                                    <input type="number" id="numBottom" value="60" min="0"
                                        class="w-10 bg-transparent text-right outline-none">
                                    <span>px</span>
                                </div>
                            </div>
                            <input type="range" id="markBottom" min="0" max="1000" value="60"
                                class="glow-slider w-full h-1 bg-slate-700/50 rounded-lg appearance-none cursor-pointer">
                        </div>

                        <button id="btnResetDefaults"
                            class="hidden text-xs text-indigo-400 hover:text-indigo-300 mt-2">Restablecer
                            valores</button>
                        <!-- Presets ocultos para preservar IDs -->
                        <div id="presetControls" class="hidden">
                            <button id="btnSavePreset"></button>
                            <select id="presetSelect"></select>
                        </div>
                    </div>

                    <!-- Controles Manuales -->
                    <div id="manualControls"
                        class="space-y-4 hidden bg-slate-800/30 p-4 rounded-xl border border-slate-300 dark:border-slate-700/50">
                        <p class="text-xs text-indigo-400 mb-1 font-semibold">Tapa manualmente la marca de agua</p>
                        <div>
                            <div
                                class="flex justify-between items-center text-xs text-slate-700 dark:text-slate-300 mb-2">
                                <span>Grosor del pincel</span>
                                <input type="number" id="numBrush" value="30" min="5"
                                    class="w-12 bg-slate-50 dark:bg-[#2a2b36] p-1 text-right rounded outline-none border border-slate-300 dark:border-slate-700">
                            </div>
                            <input type="range" id="brushSize" min="5" max="200" value="30" class="glow-slider w-full">
                        </div>
                        <div class="flex gap-2">
                            <button id="btnUndoMask" disabled
                                class="flex-1 text-xs py-2 bg-slate-700/50 hover:bg-slate-700 rounded-lg disabled:opacity-50">Deshacer</button>
                            <button id="btnClearMask"
                                class="flex-1 text-xs py-2 bg-red-900/30 hover:bg-red-900/50 text-red-400 rounded-lg border border-red-900/50">Limpiar</button>
                        </div>
                    </div>

                    <!-- Select de limpieza oculto para preservar funcionalidad js original pero usando clone siempre (como Gemini Edit Studio) -->
                    <select id="cleanMethod" class="hidden">
                        <option value="clone" selected></option>
                    </select>

                    <div class="mt-8">
                        <button id="btnClean" class="w-full relative group">
                            <div
                                class="absolute -inset-0.5 bg-gradient-to-r from-blue-500 to-purple-600 rounded-xl blur opacity-60 group-hover:opacity-100 transition duration-200">
                            </div>
                            <div
                                class="relative w-full bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-400 hover:to-purple-500 text-slate-900 dark:text-white text-sm font-semibold py-3.5 px-4 rounded-xl shadow-lg flex items-center justify-center gap-2">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z">
                                    </path>
                                </svg>
                                LIMPIAR IMAGEN
                            </div>
                        </button>
                        <button id="btnReset"
                            class="w-full bg-slate-50 dark:bg-[#2a2b36] hover:bg-slate-100 dark:bg-[#323440] text-slate-800 dark:text-slate-200 text-sm font-semibold py-3 px-4 rounded-xl transition-all hidden border border-slate-300 dark:border-slate-700">↩
                            Volver a Editar</button>
                        <button id="btnDownload" class="w-full mt-3 relative group hidden">
                            <div
                                class="absolute -inset-0.5 bg-gradient-to-r from-emerald-500 to-teal-500 rounded-xl blur opacity-60 group-hover:opacity-100 transition duration-200">
                            </div>
                            <div
                                class="relative w-full bg-white dark:bg-[#1b1c26] hover:bg-[#20222f] border border-emerald-500/50 text-emerald-400 text-sm font-semibold py-3.5 px-4 rounded-xl flex items-center justify-center gap-2">
                                Guardar Imagen Final
                            </div>
                        </button>
                    </div>

                    <p class="text-[10px] text-center text-slate-500 mt-2">*Gemini 1.5 Pro AI Engine active</p>
                </div>
            </div> <!-- End of panelIndividual -->

            <!-- PANEL DE LOTE -->
            <div id="panelBatch" class="flex flex-col gap-6 hidden">
                <div class="flex flex-col">
                    <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-3">Sube varias
                        imágenes a la vez</label>

                    <!-- Carga de archivo múltiple -->
                    <div
                        class="relative bg-slate-100 dark:bg-[#13141c]/50 rounded-2xl border border-slate-300 dark:border-slate-700/50 p-6 flex flex-col items-center justify-center hover:border-indigo-500/50 transition-colors shadow-inner upload-box">
                        <input type="file" id="batchImageInput" accept="image/png, image/jpeg, image/webp" multiple
                            class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10">

                        <div
                            class="bg-white dark:bg-[#1b1c26] p-3 rounded-2xl mb-4 border border-slate-300 dark:border-slate-700/50 glow-icon">
                            <svg class="w-6 h-6 text-indigo-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                                    d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z">
                                </path>
                            </svg>
                        </div>
                        <p class="text-slate-700 dark:text-slate-300 text-sm mb-4">Añade hasta 50 imágenes</p>
                        <button
                            class="bg-transparent border border-slate-600 text-slate-700 dark:text-slate-300 hover:text-slate-900 dark:text-white hover:border-slate-400 px-4 py-2 rounded-lg text-xs font-medium transition-colors mb-2">
                            Elegir archivos
                        </button>
                    </div>

                    <div id="batchStats"
                        class="mt-4 hidden p-4 bg-slate-800/50 rounded-xl border border-slate-300 dark:border-slate-700/50">
                        <p class="text-sm text-slate-700 dark:text-slate-300">Imágenes detectadas: <span id="batchCount"
                                class="font-bold text-indigo-400">0</span></p>
                        <!-- Loader visual -->
                        <div class="w-full bg-slate-700 rounded-full h-2.5 mt-3">
                            <div id="batchProgress" class="bg-indigo-500 h-2.5 rounded-full" style="width: 0%"></div>
                        </div>
                        <p id="batchStatusText" class="text-xs text-slate-500 dark:text-slate-400 mt-2 text-right">0%
                            Completado</p>
                    </div>
                </div>

                <div class="flex-1 overflow-y-auto max-h-[300px] rounded-xl custom-scroll border border-slate-300 dark:border-slate-700/50 hidden"
                    id="batchPreviewList">
                    <!-- Lista de procesados aquí -->
                </div>

                <div class="mt-4">
                    <button id="btnProcessBatch" class="w-full relative group">
                        <div
                            class="absolute -inset-0.5 bg-gradient-to-r from-blue-500 to-purple-600 rounded-xl blur opacity-60 group-hover:opacity-100 transition duration-200">
                        </div>
                        <div
                            class="relative w-full bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-400 hover:to-purple-500 text-slate-900 dark:text-white text-sm font-semibold py-3.5 px-4 rounded-xl shadow-lg flex items-center justify-center gap-2">
                            PROCESAR TODO (Óvalo Automático)
                        </div>
                    </button>

                    <button id="btnDownloadBatch" class="w-full mt-3 relative group hidden">
                        <div
                            class="absolute -inset-0.5 bg-gradient-to-r from-emerald-500 to-teal-500 rounded-xl blur opacity-60 group-hover:opacity-100 transition duration-200">
                        </div>
                        <div
                            class="relative w-full bg-white dark:bg-[#1b1c26] hover:bg-[#20222f] border border-emerald-500/50 text-emerald-400 text-sm font-semibold py-3.5 px-4 rounded-xl flex items-center justify-center gap-2">
                            Descargar Todas (.ZIP)
                        </div>
                    </button>
                </div>
            </div>
        </div>

        <!-- Panel de Visualización (Canvas) -->
        <div
            class="w-full lg:flex-1 p-4 sm:p-6 bg-white min-h-[60vh] lg:min-h-[90vh] relative flex flex-col justify-between">

            <!-- Toolbar superior flotante en el canvas -->
            <div
                class="absolute top-6 right-6 z-20 bg-slate-200/50 backdrop-blur-md rounded-2xl flex items-center p-1.5 gap-1 shadow-sm border border-white/40">
                <button id="btnToolCompare" class="p-2 text-slate-600 hover:bg-white rounded-xl transition-colors"
                    title="Ver Original"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z">
                        </path>
                    </svg></button>
                <div class="w-px h-6 bg-slate-300 mx-1"></div>
                <button id="btnToolZoom" class="p-2 text-slate-600 hover:bg-white rounded-xl transition-colors"
                    title="Acercar"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7"></path>
                    </svg></button>
                <button id="btnToolZoomOut" class="p-2 text-slate-600 hover:bg-white rounded-xl transition-colors"
                    title="Alejar"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM13 7H7"></path>
                    </svg></button>
                <div class="w-px h-6 bg-slate-300 mx-1"></div>
                <!-- Herramienta de Mano (Pan) añadida, los otros remanentes de la imagen fueron eliminados -->
                <button id="btnToolPan" class="p-2 text-slate-600 hover:bg-white rounded-xl transition-colors"
                    title="Mover Lienzo">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M7 11.5V14m0-2.5v-6a1.5 1.5 0 113 0m-3 6a1.5 1.5 0 00-3 0v2a7.5 7.5 0 0015 0v-5a1.5 1.5 0 00-3 0m-6-3V11m0-5.5v-1a1.5 1.5 0 013 0v1m0 0V11m0-2.5v-1a1.5 1.5 0 013 0v1m0 0V11">
                        </path>
                    </svg>
                </button>
                <div class="w-px h-6 bg-slate-300 mx-1"></div>
                <button id="btnToolResetView" class="p-2 text-slate-600 hover:bg-white rounded-xl transition-colors"
                    title="Centrar y Ajustar al Inicio">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M4 8V4m0 0h4M4 4l5 5m11-5h-4m4 0v4m0-4l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5v-4m0 4h-4m4 0l-5-5">
                        </path>
                    </svg>
                </button>
            </div>

            <!-- Content Area -->
            <div class="flex-1 flex flex-col items-center justify-center relative w-full h-full">

                <div id="placeholder"
                    class="text-center flex flex-col items-center max-w-sm mt-12 relative z-10 w-full">
                    <div class="relative w-48 h-48 mb-8 flex justify-center items-center">
                        <div class="absolute inset-0 bg-gradient-to-t from-blue-100/50 to-transparent flex flex-col justify-end pb-4"
                            style="clip-path: polygon(50% 0%, 100% 100%, 0% 100%); width: 200px; height: 200px; margin: 0 auto; margin-top: -100px;">
                        </div>
                        <img src="https://www.gstatic.com/lamda/images/sparkle_resting_v2_darkmode_2bdb7df2724e4500732de.gif"
                            class="w-24 h-24 object-contain brightness-110 drop-shadow-[0_0_20px_rgba(139,92,246,0.5)] z-10 relative mt-[-20px]"
                            alt="Sparkle">
                    </div>

                    <h2 class="text-3xl font-extrabold text-slate-800 tracking-tight mb-2">Lienzo de Trabajo</h2>
                    <p class="text-slate-500 text-sm mb-12">Sube una imagen para ver la magia en tiempo real.</p>

                    <!-- Simulación de plataforma base -->
                    <div class="w-64 h-8 bg-gradient-to-b from-slate-200 to-slate-400 rounded-sm transform perspective-1000 rotateX-45 shadow-[0_20px_40px_-10px_rgba(0,0,0,0.3)] mx-auto relative mt-4"
                        style="transform: perspective(300px) rotateX(45deg); border: 1px solid #cbd5e1; border-bottom: 4px solid #94a3b8;">
                        <svg class="absolute top-[-20px] left-1/2 transform -translate-x-1/2 w-8 h-8 text-slate-700 dark:text-slate-300 animate-spin-slow"
                            fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4">
                            </circle>
                            <path class="opacity-75" fill="currentColor"
                                d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                            </path>
                        </svg>
                    </div>
                </div>

                <div class="canvas-container w-full h-full hidden flex items-center justify-center relative"
                    id="canvasWrapper">
                    <canvas id="mainCanvas"
                        class="max-w-full max-h-[75vh] object-contain drop-shadow-2xl rounded-sm"></canvas>
                    <canvas id="loupeCanvas" width="150" height="150"
                        class="absolute hidden rounded-full border-[4px] border-slate-800 shadow-2xl pointer-events-none z-50 bg-slate-100 dark:bg-[#13141c]"></canvas>
                </div>
            </div>

        </div>

    </div>

    <!-- Script de lógica Modular -->
    <script type="module" src="js/app.js"></script>
</body>

</html>